{"version":3,"file":"stream-parser.js","names":["_token","require","_colmetadataTokenParser","_interopRequireDefault","_doneTokenParser","_envChangeTokenParser","_infoerrorTokenParser","_fedauthInfoParser","_featureExtAckParser","_loginackTokenParser","_orderTokenParser","_returnstatusTokenParser","_returnvalueTokenParser","_rowTokenParser","_nbcrowTokenParser","_sspiTokenParser","obj","__esModule","default","tokenParsers","TYPE","DONE","doneParser","DONEINPROC","doneInProcParser","DONEPROC","doneProcParser","ENVCHANGE","envChangeParser","ERROR","errorParser","FEDAUTHINFO","fedAuthInfoParser","FEATUREEXTACK","featureExtAckParser","INFO","infoParser","LOGINACK","loginAckParser","ORDER","orderParser","RETURNSTATUS","returnStatusParser","RETURNVALUE","returnValueParser","SSPI","sspiParser","StreamBuffer","constructor","iterable","iterator","Symbol","asyncIterator","call","buffer","Buffer","alloc","position","waitForChunk","result","next","done","Error","length","value","concat","slice","Parser","parseTokens","debug","options","colMetadata","token","onDoneParsing","t","streamBuffer","parser","err","suspended","ColMetadataToken","columns","type","readUInt8","COLMETADATA","colMetadataParser","ROW","rowParser","NBCROW","nbcRowParser","undefined","suspend","awaitData","callback","readInt8","data","readInt16LE","readInt16BE","readUInt16LE","readUInt16BE","readInt32LE","readInt32BE","readUInt32LE","readUInt32BE","readBigInt64LE","readInt64LE","Math","pow","readInt64BE","readBigUInt64LE","readUInt64LE","readUInt64BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","readUInt24LE","low","high","readUInt40LE","readUNumeric64LE","readUNumeric96LE","dword1","dword2","dword3","readUNumeric128LE","dword4","readBuffer","readBVarChar","toString","readUsVarChar","readBVarByte","readUsVarByte","_default","exports","module"],"sources":["../../src/token/stream-parser.ts"],"sourcesContent":["import Debug from '../debug';\nimport { type InternalConnectionOptions } from '../connection';\n\nimport { TYPE, Token, ColMetadataToken } from './token';\n\nimport colMetadataParser, { type ColumnMetadata } from './colmetadata-token-parser';\nimport { doneParser, doneInProcParser, doneProcParser } from './done-token-parser';\nimport envChangeParser from './env-change-token-parser';\nimport { errorParser, infoParser } from './infoerror-token-parser';\nimport fedAuthInfoParser from './fedauth-info-parser';\nimport featureExtAckParser from './feature-ext-ack-parser';\nimport loginAckParser from './loginack-token-parser';\nimport orderParser from './order-token-parser';\nimport returnStatusParser from './returnstatus-token-parser';\nimport returnValueParser from './returnvalue-token-parser';\nimport rowParser from './row-token-parser';\nimport nbcRowParser from './nbcrow-token-parser';\nimport sspiParser from './sspi-token-parser';\n\nconst tokenParsers = {\n  [TYPE.DONE]: doneParser,\n  [TYPE.DONEINPROC]: doneInProcParser,\n  [TYPE.DONEPROC]: doneProcParser,\n  [TYPE.ENVCHANGE]: envChangeParser,\n  [TYPE.ERROR]: errorParser,\n  [TYPE.FEDAUTHINFO]: fedAuthInfoParser,\n  [TYPE.FEATUREEXTACK]: featureExtAckParser,\n  [TYPE.INFO]: infoParser,\n  [TYPE.LOGINACK]: loginAckParser,\n  [TYPE.ORDER]: orderParser,\n  [TYPE.RETURNSTATUS]: returnStatusParser,\n  [TYPE.RETURNVALUE]: returnValueParser,\n  [TYPE.SSPI]: sspiParser\n};\n\nexport type ParserOptions = Pick<InternalConnectionOptions, 'useUTC' | 'lowerCaseGuids' | 'tdsVersion' | 'useColumnNames' | 'columnNameReplacer' | 'camelCaseColumns'>;\n\nclass StreamBuffer {\n  declare iterator: AsyncIterator<Buffer, any, undefined> | Iterator<Buffer, any, undefined>;\n  declare buffer: Buffer;\n  declare position: number;\n\n  constructor(iterable: AsyncIterable<Buffer> | Iterable<Buffer>) {\n    this.iterator = ((iterable as AsyncIterable<Buffer>)[Symbol.asyncIterator] || (iterable as Iterable<Buffer>)[Symbol.iterator]).call(iterable);\n\n    this.buffer = Buffer.alloc(0);\n    this.position = 0;\n  }\n\n  async waitForChunk() {\n    const result = await this.iterator.next();\n    if (result.done) {\n      throw new Error('unexpected end of data');\n    }\n\n    if (this.position === this.buffer.length) {\n      this.buffer = result.value;\n    } else {\n      this.buffer = Buffer.concat([this.buffer.slice(this.position), result.value]);\n    }\n    this.position = 0;\n  }\n}\n\nclass Parser {\n  declare debug: Debug;\n  declare colMetadata: ColumnMetadata[];\n  declare options: ParserOptions;\n\n  declare suspended: boolean;\n  declare next: (() => void) | undefined;\n  declare streamBuffer: StreamBuffer;\n\n  static async *parseTokens(iterable: AsyncIterable<Buffer> | Iterable<Buffer>, debug: Debug, options: ParserOptions, colMetadata: ColumnMetadata[] = []) {\n    let token: Token | undefined;\n    const onDoneParsing = (t: Token | undefined) => { token = t; };\n\n    const streamBuffer = new StreamBuffer(iterable);\n\n    const parser = new Parser(streamBuffer, debug, options);\n    parser.colMetadata = colMetadata;\n\n    while (true) {\n      try {\n        await streamBuffer.waitForChunk();\n      } catch (err: unknown) {\n        if (streamBuffer.position === streamBuffer.buffer.length) {\n          return;\n        }\n\n        throw err;\n      }\n\n      if (parser.suspended) {\n        // Unsuspend and continue from where ever we left off.\n        parser.suspended = false;\n        const next = parser.next!;\n\n        next();\n\n        // Check if a new token was parsed after unsuspension.\n        if (!parser.suspended && token) {\n          if (token instanceof ColMetadataToken) {\n            parser.colMetadata = token.columns;\n          }\n\n          yield token;\n        }\n      }\n\n      while (!parser.suspended && parser.position + 1 <= parser.buffer.length) {\n        const type = parser.buffer.readUInt8(parser.position);\n\n        parser.position += 1;\n\n        if (type === TYPE.COLMETADATA) {\n          const token = await colMetadataParser(parser);\n          parser.colMetadata = token.columns;\n          yield token;\n        } else if (type === TYPE.ROW) {\n          yield rowParser(parser);\n        } else if (type === TYPE.NBCROW) {\n          yield nbcRowParser(parser);\n        } else if (tokenParsers[type]) {\n          tokenParsers[type](parser, parser.options, onDoneParsing);\n\n          // Check if a new token was parsed after unsuspension.\n          if (!parser.suspended && token) {\n            if (token instanceof ColMetadataToken) {\n              parser.colMetadata = token.columns;\n            }\n            yield token;\n          }\n        } else {\n          throw new Error('Unknown type: ' + type);\n        }\n      }\n    }\n  }\n\n  constructor(streamBuffer: StreamBuffer, debug: Debug, options: ParserOptions) {\n    this.debug = debug;\n    this.colMetadata = [];\n    this.options = options;\n\n    this.streamBuffer = streamBuffer;\n    this.suspended = false;\n    this.next = undefined;\n  }\n\n  get buffer() {\n    return this.streamBuffer.buffer;\n  }\n\n  get position() {\n    return this.streamBuffer.position;\n  }\n\n  set position(value) {\n    this.streamBuffer.position = value;\n  }\n\n  suspend(next: () => void) {\n    this.suspended = true;\n    this.next = next;\n  }\n\n  awaitData(length: number, callback: () => void) {\n    if (this.position + length <= this.buffer.length) {\n      callback();\n    } else {\n      this.suspend(() => {\n        this.awaitData(length, callback);\n      });\n    }\n  }\n\n  readInt8(callback: (data: number) => void) {\n    this.awaitData(1, () => {\n      const data = this.buffer.readInt8(this.position);\n      this.position += 1;\n      callback(data);\n    });\n  }\n\n  readUInt8(callback: (data: number) => void) {\n    this.awaitData(1, () => {\n      const data = this.buffer.readUInt8(this.position);\n      this.position += 1;\n      callback(data);\n    });\n  }\n\n  readInt16LE(callback: (data: number) => void) {\n    this.awaitData(2, () => {\n      const data = this.buffer.readInt16LE(this.position);\n      this.position += 2;\n      callback(data);\n    });\n  }\n\n  readInt16BE(callback: (data: number) => void) {\n    this.awaitData(2, () => {\n      const data = this.buffer.readInt16BE(this.position);\n      this.position += 2;\n      callback(data);\n    });\n  }\n\n  readUInt16LE(callback: (data: number) => void) {\n    this.awaitData(2, () => {\n      const data = this.buffer.readUInt16LE(this.position);\n      this.position += 2;\n      callback(data);\n    });\n  }\n\n  readUInt16BE(callback: (data: number) => void) {\n    this.awaitData(2, () => {\n      const data = this.buffer.readUInt16BE(this.position);\n      this.position += 2;\n      callback(data);\n    });\n  }\n\n  readInt32LE(callback: (data: number) => void) {\n    this.awaitData(4, () => {\n      const data = this.buffer.readInt32LE(this.position);\n      this.position += 4;\n      callback(data);\n    });\n  }\n\n  readInt32BE(callback: (data: number) => void) {\n    this.awaitData(4, () => {\n      const data = this.buffer.readInt32BE(this.position);\n      this.position += 4;\n      callback(data);\n    });\n  }\n\n  readUInt32LE(callback: (data: number) => void) {\n    this.awaitData(4, () => {\n      const data = this.buffer.readUInt32LE(this.position);\n      this.position += 4;\n      callback(data);\n    });\n  }\n\n  readUInt32BE(callback: (data: number) => void) {\n    this.awaitData(4, () => {\n      const data = this.buffer.readUInt32BE(this.position);\n      this.position += 4;\n      callback(data);\n    });\n  }\n\n  readBigInt64LE(callback: (data: bigint) => void) {\n    this.awaitData(8, () => {\n      const data = this.buffer.readBigInt64LE(this.position);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readInt64LE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const data = Math.pow(2, 32) * this.buffer.readInt32LE(this.position + 4) + ((this.buffer[this.position + 4] & 0x80) === 0x80 ? 1 : -1) * this.buffer.readUInt32LE(this.position);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readInt64BE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const data = Math.pow(2, 32) * this.buffer.readInt32BE(this.position) + ((this.buffer[this.position] & 0x80) === 0x80 ? 1 : -1) * this.buffer.readUInt32BE(this.position + 4);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readBigUInt64LE(callback: (data: bigint) => void) {\n    this.awaitData(8, () => {\n      const data = this.buffer.readBigUInt64LE(this.position);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readUInt64LE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const data = Math.pow(2, 32) * this.buffer.readUInt32LE(this.position + 4) + this.buffer.readUInt32LE(this.position);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readUInt64BE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const data = Math.pow(2, 32) * this.buffer.readUInt32BE(this.position) + this.buffer.readUInt32BE(this.position + 4);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readFloatLE(callback: (data: number) => void) {\n    this.awaitData(4, () => {\n      const data = this.buffer.readFloatLE(this.position);\n      this.position += 4;\n      callback(data);\n    });\n  }\n\n  readFloatBE(callback: (data: number) => void) {\n    this.awaitData(4, () => {\n      const data = this.buffer.readFloatBE(this.position);\n      this.position += 4;\n      callback(data);\n    });\n  }\n\n  readDoubleLE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const data = this.buffer.readDoubleLE(this.position);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readDoubleBE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const data = this.buffer.readDoubleBE(this.position);\n      this.position += 8;\n      callback(data);\n    });\n  }\n\n  readUInt24LE(callback: (data: number) => void) {\n    this.awaitData(3, () => {\n      const low = this.buffer.readUInt16LE(this.position);\n      const high = this.buffer.readUInt8(this.position + 2);\n\n      this.position += 3;\n\n      callback(low | (high << 16));\n    });\n  }\n\n  readUInt40LE(callback: (data: number) => void) {\n    this.awaitData(5, () => {\n      const low = this.buffer.readUInt32LE(this.position);\n      const high = this.buffer.readUInt8(this.position + 4);\n\n      this.position += 5;\n\n      callback((0x100000000 * high) + low);\n    });\n  }\n\n  readUNumeric64LE(callback: (data: number) => void) {\n    this.awaitData(8, () => {\n      const low = this.buffer.readUInt32LE(this.position);\n      const high = this.buffer.readUInt32LE(this.position + 4);\n\n      this.position += 8;\n\n      callback((0x100000000 * high) + low);\n    });\n  }\n\n  readUNumeric96LE(callback: (data: number) => void) {\n    this.awaitData(12, () => {\n      const dword1 = this.buffer.readUInt32LE(this.position);\n      const dword2 = this.buffer.readUInt32LE(this.position + 4);\n      const dword3 = this.buffer.readUInt32LE(this.position + 8);\n\n      this.position += 12;\n\n      callback(dword1 + (0x100000000 * dword2) + (0x100000000 * 0x100000000 * dword3));\n    });\n  }\n\n  readUNumeric128LE(callback: (data: number) => void) {\n    this.awaitData(16, () => {\n      const dword1 = this.buffer.readUInt32LE(this.position);\n      const dword2 = this.buffer.readUInt32LE(this.position + 4);\n      const dword3 = this.buffer.readUInt32LE(this.position + 8);\n      const dword4 = this.buffer.readUInt32LE(this.position + 12);\n\n      this.position += 16;\n\n      callback(dword1 + (0x100000000 * dword2) + (0x100000000 * 0x100000000 * dword3) + (0x100000000 * 0x100000000 * 0x100000000 * dword4));\n    });\n  }\n\n  // Variable length data\n\n  readBuffer(length: number, callback: (data: Buffer) => void) {\n    this.awaitData(length, () => {\n      const data = this.buffer.slice(this.position, this.position + length);\n      this.position += length;\n      callback(data);\n    });\n  }\n\n  // Read a Unicode String (BVARCHAR)\n  readBVarChar(callback: (data: string) => void) {\n    this.readUInt8((length) => {\n      this.readBuffer(length * 2, (data) => {\n        callback(data.toString('ucs2'));\n      });\n    });\n  }\n\n  // Read a Unicode String (USVARCHAR)\n  readUsVarChar(callback: (data: string) => void) {\n    this.readUInt16LE((length) => {\n      this.readBuffer(length * 2, (data) => {\n        callback(data.toString('ucs2'));\n      });\n    });\n  }\n\n  // Read binary data (BVARBYTE)\n  readBVarByte(callback: (data: Buffer) => void) {\n    this.readUInt8((length) => {\n      this.readBuffer(length, callback);\n    });\n  }\n\n  // Read binary data (USVARBYTE)\n  readUsVarByte(callback: (data: Buffer) => void) {\n    this.readUInt16LE((length) => {\n      this.readBuffer(length, callback);\n    });\n  }\n}\n\nexport default Parser;\nmodule.exports = Parser;\n"],"mappings":"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"}